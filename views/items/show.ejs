<%- include('../partials/header') %>

<h1>ITEM DETAILS</h1>
    <section id="show-page">

        <div class="bold-header">Item: </div>
        <div class="result">
            <%= item.item %>
        </div>
        <div class="bold-header">Brand: </div>
        <div class="result">
            <%= item.brand %>
        </div>
        <div class="bold-header">Owner: </div>
        <div class="result">
            <%= item.owner %>
        </div>
    </section>

    <br><br>
    <h1>Comments</h1>
    <% if (user) { %>
        <form id="add-comment-form" method="POST" action="/items/<%= item._id %>/comments">
            <label></label>
            <textarea class="content" name="content"></textarea>
            <br><label>Condition:</label>
            <select name="condition">
                <option value="Like New">Like New</option>
                <option value="Excellent">Excellent</option>
                <option value="Good">Good</option>
                <option value="Fair">Fair</option>
                <option value="Poor">Poor</option>
            </select>
            <input type="submit" value="Add Comment">
        </form>
        <% } %>

            <% if (item.comments.length) { %>
                <table>
                    <div class="tbl-header">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Date</th>
                            <th>Comments</th>
                            <th>Condition</th>
                        </tr>
                    </thead>
                    </div>
                        <tbody>
                        <% item.comments.forEach(function(c) { %>
                            <tr>
                                <td class="comment-user"><img alt="avatar" src="<%= c.userAvatar %>">
                                    <%= c.userName %>
                                </td>
                                <td>
                                    <%= c.createdAt.toLocaleDateString() %>
                                </td>
                                <td>
                                    <%= c.content %>
                                </td>
                                <td>
                                    <%= c.condition %>
                                </td>
                                <td>
                                    <% if (user && user._id.equals(c.user)) { %>
                                        <form action="/comments/<%= c._id %>?_method=DELETE" method="POST">
                                            <button type="submit">X</button>
                                        </form>
                                        <form action="/comments/<%= c._id %>?_method=PUT" method="POST">
                                            <input type="text" name="content" value="<%= c.text %>">
                                            <button type="submit">UPDATE COMMENT</button>
                                        </form>
                                        <% } %>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>
                <% } else { %>
                    <h5>No Comments Yet</h5>
                    <% } %>
                        <%- include('../partials/footer') %>